import{r as a,g as G,o as W,u as q,d as m,c as v,$ as A,p as I,q as k,m as J,K as U,k as c,s as Q,i as V,l as X,D as Z,n as ee,S as te,t as se,v as re,a as t,j as z,F as ne,A as oe,N as ae,L as ie,w as le,H as ce,x as ue,y as de,z as ge,G as me,R as fe,I as pe,P as xe,J as Ce}from"./main.7b829983.js";import{L as Ee}from"./LexicalNestedComposer.5675d17f.js";import{I as Ne}from"./ImageResizer.a405990b.js";const O=new Set;function he(l){if(!O.has(l))throw new Promise(d=>{const n=new Image;n.src=l,n.onload=()=>{O.add(l),d(null)}})}function Se({altText:l,className:d,imageRef:n,src:f,width:h,height:p,maxWidth:S}){return he(f),t("img",{className:d||void 0,src:f,alt:l,ref:n,style:{height:p,maxWidth:S,width:h},draggable:"false"})}function ve({src:l,altText:d,nodeKey:n,width:f,height:h,maxWidth:p,resizable:S,showCaption:x,caption:u,captionsEnabled:T}){const C=a.exports.useRef(null),b=a.exports.useRef(null),[i,g,M]=G(n),[E,w]=a.exports.useState(!1),{isCollabActive:H}=W(),[s]=q(),[_,$]=a.exports.useState(null),D=a.exports.useRef(null),R=a.exports.useCallback(r=>{if(i&&m(v())){r.preventDefault();const e=A(n);I(e)&&e.remove()}return!1},[i,n]),P=a.exports.useCallback(r=>{const o=v(),e=b.current;if(i&&m(o)&&o.getNodes().length===1){if(x)return k(null),r.preventDefault(),u.focus(),!0;if(e!==null&&e!==document.activeElement)return r.preventDefault(),e.focus(),!0}return!1},[u,i,x]),L=a.exports.useCallback(r=>D.current===u||b.current===r.target?(k(null),s.update(()=>{g(!0);const o=s.getRootElement();o!==null&&o.focus()}),!0):!1,[u,s,g]);a.exports.useEffect(()=>{let r=!0;const o=J(s.registerUpdateListener(({editorState:e})=>{r&&$(e.read(()=>v()))}),s.registerCommand(te,(e,N)=>(D.current=N,!1),c),s.registerCommand(ee,e=>{const N=e;return E?!0:N.target===C.current?(N.shiftKey?g(!i):(M(),g(!0)),!0):!1},c),s.registerCommand(Z,e=>e.target===C.current?(e.preventDefault(),!0):!1,c),s.registerCommand(X,R,c),s.registerCommand(V,R,c),s.registerCommand(Q,P,c),s.registerCommand(U,L,c));return()=>{r=!1,o()}},[M,s,E,i,n,R,P,L,g]);const K=()=>{s.update(()=>{const r=A(n);I(r)&&r.setShowCaption(!0)})},B=(r,o)=>{setTimeout(()=>{w(!1)},200),s.update(()=>{const e=A(n);I(e)&&e.setWidthAndHeight(r,o)})},F=()=>{w(!0)},{historyState:Y}=se();re();const j=i&&m(_)&&!E,y=i||E;return t(a.exports.Suspense,{fallback:null,children:z(ne,{children:[t("div",{draggable:j,children:t(Se,{className:y?`focused ${m(_)?"draggable":""}`:null,src:l,altText:d,imageRef:C,width:f,height:h,maxWidth:p})}),x&&t("div",{className:"image-caption-container",children:z(Ee,{initialEditor:u,children:[t(oe,{}),t(ae,{}),t(ie,{}),t(le,{}),t(ce,{}),t(ue,{}),H?t(de,{id:u.getKey(),providerFactory:ge,shouldBootstrap:!0}):t(me,{externalHistoryState:Y}),t(fe,{contentEditable:t(pe,{className:"ImageNode__contentEditable"}),placeholder:t(xe,{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:Ce})]})}),S&&m(_)&&y&&t(Ne,{showCaption:x,setShowCaption:K,editor:s,buttonRef:b,imageRef:C,maxWidth:p,onResizeStart:F,onResizeEnd:B,captionsEnabled:T})]})})}export{ve as default};
