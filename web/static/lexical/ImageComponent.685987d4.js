import{r as e,g as t,o as a,u as s,d as r,c as n,$ as o,p as i,q as l,m as c,S as d,k as u,i as m,D as p,l as h,n as g,s as f,K as x,t as b,v as C,a as w,j as v,F as R,A as E,N,L as S,w as y,H as I,x as W,y as k,z,G as D,R as j,I as K,P as L,J as T}from"./main.240d9b7b.js";import{L as _}from"./LexicalNestedComposer.0daa9a65.js";import{I as A}from"./ImageResizer.9cb3d539.js";const H=new Set;function B({altText:e,className:t,imageRef:a,src:s,width:r,height:n,maxWidth:o}){return function(e){if(!H.has(e))throw new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{H.add(e),t(null)}}))}(s),w("img",{className:t||void 0,src:s,alt:e,ref:a,style:{height:n,maxWidth:o,width:r},draggable:"false"})}function F({src:H,altText:F,nodeKey:P,width:q,height:G,maxWidth:J,resizable:U,showCaption:$,caption:M,captionsEnabled:O}){const Q=e.exports.useRef(null),V=e.exports.useRef(null),[X,Y,Z]=t(P),[ee,te]=e.exports.useState(!1),{isCollabActive:ae}=a(),[se]=s(),[re,ne]=e.exports.useState(null),oe=e.exports.useRef(null),ie=e.exports.useCallback((e=>{if(X&&r(n())){e.preventDefault();const t=o(P);i(t)&&t.remove()}return!1}),[X,P]),le=e.exports.useCallback((e=>{const t=n(),a=V.current;if(X&&r(t)&&1===t.getNodes().length){if($)return l(null),e.preventDefault(),M.focus(),!0;if(null!==a&&a!==document.activeElement)return e.preventDefault(),a.focus(),!0}return!1}),[M,X,$]),ce=e.exports.useCallback((e=>(oe.current===M||V.current===e.target)&&(l(null),se.update((()=>{Y(!0);const e=se.getRootElement();null!==e&&e.focus()})),!0)),[M,se,Y]);e.exports.useEffect((()=>{let e=!0;const t=c(se.registerUpdateListener((({editorState:t})=>{e&&ne(t.read((()=>n())))})),se.registerCommand(d,((e,t)=>(oe.current=t,!1)),u),se.registerCommand(m,(e=>{const t=e;return!!ee||t.target===Q.current&&(t.shiftKey?Y(!X):(Z(),Y(!0)),!0)}),u),se.registerCommand(p,(e=>e.target===Q.current&&(e.preventDefault(),!0)),u),se.registerCommand(h,ie,u),se.registerCommand(g,ie,u),se.registerCommand(f,le,u),se.registerCommand(x,ce,u));return()=>{e=!1,t()}}),[Z,se,ee,X,P,ie,le,ce,Y]);const{historyState:de}=b();C();const ue=X&&r(re)&&!ee,me=X||ee;return w(e.exports.Suspense,{fallback:null,children:v(R,{children:[w("div",{draggable:ue,children:w(B,{className:me?"focused "+(r(re)?"draggable":""):null,src:H,altText:F,imageRef:Q,width:q,height:G,maxWidth:J})}),$&&w("div",{className:"image-caption-container",children:v(_,{initialEditor:M,children:[w(E,{}),w(N,{}),w(S,{}),w(y,{}),w(I,{}),w(W,{}),ae?w(k,{id:M.getKey(),providerFactory:z,shouldBootstrap:!0}):w(D,{externalHistoryState:de}),w(j,{contentEditable:w(K,{className:"ImageNode__contentEditable"}),placeholder:w(L,{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:T})]})}),U&&r(re)&&me&&w(A,{showCaption:$,setShowCaption:()=>{se.update((()=>{const e=o(P);i(e)&&e.setShowCaption(!0)}))},editor:se,buttonRef:V,imageRef:Q,maxWidth:J,onResizeStart:()=>{te(!0)},onResizeEnd:(e,t)=>{setTimeout((()=>{te(!1)}),200),se.update((()=>{const a=o(P);i(a)&&a.setWidthAndHeight(e,t)}))},captionsEnabled:O})]})})}export{F as default};
