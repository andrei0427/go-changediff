import{r as e,g as t,o as a,u as s,d as r,c as n,$ as o,p as i,q as l,s as d,m as c,S as u,k as m,i as g,D as p,l as h,n as f,t as x,K as C,v as b,w as E,a as v,j as N,F as R,A as w,N as S,L as I,x as y,H as k,y as L,z as _,G as D,I as W,R as z,J as A,P as K,O as T,Q as j}from"./main.9d8dd8ca.js";import{L as G}from"./LexicalNestedComposer.aaf5e289.js";import{I as H}from"./ImageResizer.f95a88e1.js";const M=new Set,B=j("RIGHT_CLICK_IMAGE_COMMAND");function F({altText:e,className:t,imageRef:a,src:s,width:r,height:n,maxWidth:o}){return function(e){if(!M.has(e))throw new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{M.add(e),t(null)}}))}(s),v("img",{className:t||void 0,src:s,alt:e,ref:a,style:{height:n,maxWidth:o,width:r},draggable:"false"})}function O({src:j,altText:M,nodeKey:O,width:P,height:q,maxWidth:J,resizable:Q,showCaption:U,caption:$,captionsEnabled:V}){const X=e.exports.useRef(null),Y=e.exports.useRef(null),[Z,ee,te]=t(O),[ae,se]=e.exports.useState(!1),{isCollabActive:re}=a(),[ne]=s(),[oe,ie]=e.exports.useState(null),le=e.exports.useRef(null),de=e.exports.useCallback((e=>{if(Z&&r(n())){e.preventDefault();const t=o(O);i(t)&&t.remove()}return!1}),[Z,O]),ce=e.exports.useCallback((e=>{const t=n(),a=Y.current;if(Z&&r(t)&&1===t.getNodes().length){if(U)return l(null),e.preventDefault(),$.focus(),!0;if(null!==a&&a!==document.activeElement)return e.preventDefault(),a.focus(),!0}return!1}),[$,Z,U]),ue=e.exports.useCallback((e=>(le.current===$||Y.current===e.target)&&(l(null),ne.update((()=>{ee(!0);const e=ne.getRootElement();null!==e&&e.focus()})),!0)),[$,ne,ee]),me=e.exports.useCallback((e=>{const t=e;return!!ae||t.target===X.current&&(t.shiftKey?ee(!Z):(te(),ee(!0)),!0)}),[ae,Z,ee,te]),ge=e.exports.useCallback((e=>{ne.getEditorState().read((()=>{const t=n();"IMG"===e.target.tagName&&d(t)&&1===t.getNodes().length&&ne.dispatchCommand(B,e)}))}),[ne]);e.exports.useEffect((()=>{let e=!0;const t=ne.getRootElement(),a=c(ne.registerUpdateListener((({editorState:t})=>{e&&ie(t.read((()=>n())))})),ne.registerCommand(u,((e,t)=>(le.current=t,!1)),m),ne.registerCommand(g,me,m),ne.registerCommand(B,me,m),ne.registerCommand(p,(e=>e.target===X.current&&(e.preventDefault(),!0)),m),ne.registerCommand(h,de,m),ne.registerCommand(f,de,m),ne.registerCommand(x,ce,m),ne.registerCommand(C,ue,m));return null==t||t.addEventListener("contextmenu",ge),()=>{e=!1,a(),null==t||t.removeEventListener("contextmenu",ge)}}),[te,ne,ae,Z,O,de,ce,ue,me,ge,ee]);const{historyState:pe}=b();E();const he=Z&&r(oe)&&!ae,fe=Z||ae;return v(e.exports.Suspense,{fallback:null,children:N(R,{children:[v("div",{draggable:he,children:v(F,{className:fe?"focused "+(r(oe)?"draggable":""):null,src:j,altText:M,imageRef:X,width:P,height:q,maxWidth:J})}),U&&v("div",{className:"image-caption-container",children:N(G,{initialEditor:$,children:[v(w,{}),v(S,{}),v(I,{}),v(y,{}),v(k,{}),v(L,{}),re?v(_,{id:$.getKey(),providerFactory:D,shouldBootstrap:!0}):v(W,{externalHistoryState:pe}),v(z,{contentEditable:v(A,{className:"ImageNode__contentEditable"}),placeholder:v(K,{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:T})]})}),Q&&r(oe)&&fe&&v(H,{showCaption:U,setShowCaption:()=>{ne.update((()=>{const e=o(O);i(e)&&e.setShowCaption(!0)}))},editor:ne,buttonRef:Y,imageRef:X,maxWidth:J,onResizeStart:()=>{se(!0)},onResizeEnd:(e,t)=>{setTimeout((()=>{se(!1)}),200),ne.update((()=>{const a=o(O);i(a)&&a.setWidthAndHeight(e,t)}))},captionsEnabled:V})]})})}export{B as RIGHT_CLICK_IMAGE_COMMAND,O as default};
