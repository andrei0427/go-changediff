import{T as e,r as t,g as a,u as n,d as s,c as o,$ as i,U as r,q as l,m as c,S as d,k as u,i as p,D as m,l as h,n as g,s as f,K as x,j as C,F as v,a as b,A as w,L as E,V as N,W as k,R as S,I as y,P as I,J as R,X as T,Y as D,Z as _,B as K}from"./main.2a655075.js";import{L}from"./LexicalNestedComposer.4cdae468.js";const B=new Set;function P({altText:e,className:t,imageRef:a,src:n,width:s,height:o,position:i}){return function(e){if(!B.has(e))throw new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{B.add(e),t(null)}}))}(n),b("img",{className:t||void 0,src:n,alt:e,ref:a,"data-position":i,style:{display:"block",height:o,width:s},draggable:"false"})}function j({activeEditor:e,nodeKey:a,onClose:n}){const s=e.getEditorState().read((()=>i(a))),[o,r]=t.exports.useState(s.getAltText()),[l,c]=t.exports.useState(s.getShowCaption()),[d,u]=t.exports.useState(s.getPosition());return C(v,{children:[b("div",{style:{marginBottom:"1em"},children:b(T,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:r,value:o,"data-test-id":"image-modal-alt-text-input"})}),C(D,{style:{marginBottom:"1em",width:"208px"},value:d,label:"Position",name:"position",id:"position-select",onChange:e=>{u(e.target.value)},children:[b("option",{value:"left",children:"Left"}),b("option",{value:"right",children:"Right"}),b("option",{value:"full",children:"Full Width"})]}),C("div",{className:"Input__wrapper",children:[b("input",{id:"caption",type:"checkbox",checked:l,onChange:e=>{c(e.target.checked)}}),b("label",{htmlFor:"caption",children:"Show Caption"})]}),b(_,{children:b(K,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>(()=>{const t={altText:o,position:d,showCaption:l};s&&e.update((()=>{s.update(t)})),n()})(),children:"Confirm"})})]})}function A({src:T,altText:D,nodeKey:_,width:K,height:B,showCaption:A,caption:F,position:U}){const[W,q]=e(),J=t.exports.useRef(null),V=t.exports.useRef(null),[X,Y,Z]=a(_),[$]=n(),[z,G]=t.exports.useState(null),H=t.exports.useRef(null),M=t.exports.useCallback((e=>{if(X&&s(o())){e.preventDefault();const t=i(_);r(t)&&t.remove()}return!1}),[X,_]),O=t.exports.useCallback((e=>{const t=o(),a=V.current;if(X&&s(t)&&1===t.getNodes().length){if(A)return l(null),e.preventDefault(),F.focus(),!0;if(null!==a&&a!==document.activeElement)return e.preventDefault(),a.focus(),!0}return!1}),[F,X,A]),Q=t.exports.useCallback((e=>(H.current===F||V.current===e.target)&&(l(null),$.update((()=>{Y(!0);const e=$.getRootElement();null!==e&&e.focus()})),!0)),[F,$,Y]);t.exports.useEffect((()=>{let e=!0;const t=c($.registerUpdateListener((({editorState:t})=>{e&&G(t.read((()=>o())))})),$.registerCommand(d,((e,t)=>(H.current=t,!1)),u),$.registerCommand(p,(e=>{const t=e;return t.target===J.current&&(t.shiftKey?Y(!X):(Z(),Y(!0)),!0)}),u),$.registerCommand(m,(e=>e.target===J.current&&(e.preventDefault(),!0)),u),$.registerCommand(h,M,u),$.registerCommand(g,M,u),$.registerCommand(f,O,u),$.registerCommand(x,Q,u));return()=>{e=!1,t()}}),[Z,$,X,_,M,O,Q,Y]);const ee=X&&s(z),te=X;return C(t.exports.Suspense,{fallback:null,children:[C(v,{children:[C("div",{draggable:ee,children:[b("button",{className:"image-edit-button",ref:V,onClick:()=>{q("Update Inline Image",(e=>b(j,{activeEditor:$,nodeKey:_,onClose:e})))},children:"Edit"}),b(P,{className:te?"focused "+(s(z)?"draggable":""):null,src:T,altText:D,imageRef:J,width:K,height:B,position:U})]}),A&&b("div",{className:"image-caption-container",children:C(L,{initialEditor:F,children:[b(w,{}),b(E,{}),b(N,{}),b(k,{}),b(S,{contentEditable:b(y,{className:"InlineImageNode__contentEditable"}),placeholder:b(I,{className:"InlineImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:R})]})})]}),W]})}export{j as UpdateInlineImageDialog,A as default};
