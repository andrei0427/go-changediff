import{T as B,r as o,g as $,u as Y,d as I,c as A,$ as P,U as z,q as R,m as K,K as U,k as f,s as j,i as W,l as G,D as q,n as H,S as J,j as h,F as T,a as e,A as V,L as X,V as Z,W as Q,R as ee,I as te,P as ne,J as ae,X as oe,Y as le,Z as se,B as ie}from"./main.60ca7335.js";import{L as re}from"./LexicalNestedComposer.f9db440f.js";const L=new Set;function ce(s){if(!L.has(s))throw new Promise(m=>{const a=new Image;a.src=s,a.onload=()=>{L.add(s),m(null)}})}function de({altText:s,className:m,imageRef:a,src:x,width:r,height:d,position:c}){return ce(x),e("img",{className:m||void 0,src:x,alt:s,ref:a,"data-position":c,style:{display:"block",height:d,width:r},draggable:"false"})}function ue({activeEditor:s,nodeKey:m,onClose:a}){const r=s.getEditorState().read(()=>P(m)),[d,c]=o.exports.useState(r.getAltText()),[b,v]=o.exports.useState(r.getShowCaption()),[N,C]=o.exports.useState(r.getPosition()),E=u=>{v(u.target.checked)},i=u=>{C(u.target.value)},g=()=>{const u={altText:d,position:N,showCaption:b};r&&s.update(()=>{r.update(u)}),a()};return h(T,{children:[e("div",{style:{marginBottom:"1em"},children:e(oe,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:c,value:d,"data-test-id":"image-modal-alt-text-input"})}),h(le,{style:{marginBottom:"1em",width:"208px"},value:N,label:"Position",name:"position",id:"position-select",onChange:i,children:[e("option",{value:"left",children:"Left"}),e("option",{value:"right",children:"Right"}),e("option",{value:"full",children:"Full Width"})]}),h("div",{className:"Input__wrapper",children:[e("input",{id:"caption",type:"checkbox",checked:b,onChange:E}),e("label",{htmlFor:"caption",children:"Show Caption"})]}),e(se,{children:e(ie,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>g(),children:"Confirm"})})]})}function ge({src:s,altText:m,nodeKey:a,width:x,height:r,showCaption:d,caption:c,position:b}){const[v,N]=B(),C=o.exports.useRef(null),E=o.exports.useRef(null),[i,g,u]=$(a),[n]=Y(),[w,O]=o.exports.useState(null),D=o.exports.useRef(null),_=o.exports.useCallback(l=>{if(i&&I(A())){l.preventDefault();const t=P(a);z(t)&&t.remove()}return!1},[i,a]),M=o.exports.useCallback(l=>{const p=A(),t=E.current;if(i&&I(p)&&p.getNodes().length===1){if(d)return R(null),l.preventDefault(),c.focus(),!0;if(t!==null&&t!==document.activeElement)return l.preventDefault(),t.focus(),!0}return!1},[c,i,d]),k=o.exports.useCallback(l=>D.current===c||E.current===l.target?(R(null),n.update(()=>{g(!0);const p=n.getRootElement();p!==null&&p.focus()}),!0):!1,[c,n,g]);o.exports.useEffect(()=>{let l=!0;const p=K(n.registerUpdateListener(({editorState:t})=>{l&&O(t.read(()=>A()))}),n.registerCommand(J,(t,S)=>(D.current=S,!1),f),n.registerCommand(H,t=>{const S=t;return S.target===C.current?(S.shiftKey?g(!i):(u(),g(!0)),!0):!1},f),n.registerCommand(q,t=>t.target===C.current?(t.preventDefault(),!0):!1,f),n.registerCommand(G,_,f),n.registerCommand(W,_,f),n.registerCommand(j,M,f),n.registerCommand(U,k,f));return()=>{l=!1,p()}},[u,n,i,a,_,M,k,g]);const y=i&&I(w),F=i;return h(o.exports.Suspense,{fallback:null,children:[h(T,{children:[h("div",{draggable:y,children:[e("button",{className:"image-edit-button",ref:E,onClick:()=>{N("Update Inline Image",l=>e(ue,{activeEditor:n,nodeKey:a,onClose:l}))},children:"Edit"}),e(de,{className:F?`focused ${I(w)?"draggable":""}`:null,src:s,altText:m,imageRef:C,width:x,height:r,position:b})]}),d&&e("div",{className:"image-caption-container",children:h(re,{initialEditor:c,children:[e(V,{}),e(X,{}),e(Z,{}),e(Q,{}),e(ee,{contentEditable:e(te,{className:"InlineImageNode__contentEditable"}),placeholder:e(ne,{className:"InlineImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:ae})]})})]}),v]})}export{ue as UpdateInlineImageDialog,ge as default};
