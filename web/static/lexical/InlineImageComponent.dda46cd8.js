import{V as e,r as t,g as a,u as n,d as s,c as i,$ as o,W as r,q as l,m as d,S as c,k as u,i as p,D as m,l as h,n as g,t as f,K as x,j as C,F as v,a as b,A as w,L as E,X as k,Y as N,R as S,J as y,P as I,O as R,Z as L,_,a0 as D,B as T}from"./main.9d8dd8ca.js";import{L as K}from"./LexicalNestedComposer.aaf5e289.js";const B=new Set;function P({altText:e,className:t,imageRef:a,src:n,width:s,height:i,position:o}){return function(e){if(!B.has(e))throw new Promise((t=>{const a=new Image;a.src=e,a.onload=()=>{B.add(e),t(null)}}))}(n),b("img",{className:t||void 0,src:n,alt:e,ref:a,"data-position":o,style:{display:"block",height:i,width:s},draggable:"false"})}function j({activeEditor:e,nodeKey:a,onClose:n}){const s=e.getEditorState().read((()=>o(a))),[i,r]=t.exports.useState(s.getAltText()),[l,d]=t.exports.useState(s.getShowCaption()),[c,u]=t.exports.useState(s.getPosition());return C(v,{children:[b("div",{style:{marginBottom:"1em"},children:b(L,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:r,value:i,"data-test-id":"image-modal-alt-text-input"})}),C(_,{style:{marginBottom:"1em",width:"208px"},value:c,label:"Position",name:"position",id:"position-select",onChange:e=>{u(e.target.value)},children:[b("option",{value:"left",children:"Left"}),b("option",{value:"right",children:"Right"}),b("option",{value:"full",children:"Full Width"})]}),C("div",{className:"Input__wrapper",children:[b("input",{id:"caption",type:"checkbox",checked:l,onChange:e=>{d(e.target.checked)}}),b("label",{htmlFor:"caption",children:"Show Caption"})]}),b(D,{children:b(T,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>(()=>{const t={altText:i,position:c,showCaption:l};s&&e.update((()=>{s.update(t)})),n()})(),children:"Confirm"})})]})}function A({src:L,altText:_,nodeKey:D,width:T,height:B,showCaption:A,caption:F,position:M}){const[U,W]=e(),q=t.exports.useRef(null),J=t.exports.useRef(null),[O,V,X]=a(D),[Y]=n(),[Z,$]=t.exports.useState(null),z=t.exports.useRef(null),G=t.exports.useCallback((e=>{if(O&&s(i())){e.preventDefault();const t=o(D);r(t)&&t.remove()}return!1}),[O,D]),H=t.exports.useCallback((e=>{const t=i(),a=J.current;if(O&&s(t)&&1===t.getNodes().length){if(A)return l(null),e.preventDefault(),F.focus(),!0;if(null!==a&&a!==document.activeElement)return e.preventDefault(),a.focus(),!0}return!1}),[F,O,A]),Q=t.exports.useCallback((e=>(z.current===F||J.current===e.target)&&(l(null),Y.update((()=>{V(!0);const e=Y.getRootElement();null!==e&&e.focus()})),!0)),[F,Y,V]);t.exports.useEffect((()=>{let e=!0;const t=d(Y.registerUpdateListener((({editorState:t})=>{e&&$(t.read((()=>i())))})),Y.registerCommand(c,((e,t)=>(z.current=t,!1)),u),Y.registerCommand(p,(e=>{const t=e;return t.target===q.current&&(t.shiftKey?V(!O):(X(),V(!0)),!0)}),u),Y.registerCommand(m,(e=>e.target===q.current&&(e.preventDefault(),!0)),u),Y.registerCommand(h,G,u),Y.registerCommand(g,G,u),Y.registerCommand(f,H,u),Y.registerCommand(x,Q,u));return()=>{e=!1,t()}}),[X,Y,O,D,G,H,Q,V]);const ee=O&&s(Z),te=O;return C(t.exports.Suspense,{fallback:null,children:[C(v,{children:[C("div",{draggable:ee,children:[b("button",{className:"image-edit-button",ref:J,onClick:()=>{W("Update Inline Image",(e=>b(j,{activeEditor:Y,nodeKey:D,onClose:e})))},children:"Edit"}),b(P,{className:te?"focused "+(s(Z)?"draggable":""):null,src:L,altText:_,imageRef:q,width:T,height:B,position:M})]}),A&&b("div",{className:"image-caption-container",children:C(K,{initialEditor:F,children:[b(w,{}),b(E,{}),b(k,{isLinkEditMode:!1,setIsLinkEditMode:()=>{}}),b(N,{}),b(S,{contentEditable:b(y,{className:"InlineImageNode__contentEditable"}),placeholder:b(I,{className:"InlineImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:R})]})})]}),U]})}export{j as UpdateInlineImageDialog,A as default};
