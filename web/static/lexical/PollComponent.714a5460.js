import{u as e,r as o,g as t,d as n,c as l,$ as s,_ as a,m as i,i as d,k as r,l as c,n as p,a as u,j as _,B as h,o as N,a0 as m,a1 as f}from"./main.2a655075.js";function x({option:e,index:t,options:n,totalVotes:l,withPollNode:s}){const{clientID:a}=N(),i=o.exports.useRef(null),d=e.votes,r=-1!==d.indexOf(a),c=d.length,p=e.text;return _("div",{className:"PollNode__optionContainer",children:[u("div",{className:m("PollNode__optionCheckboxWrapper",r&&"PollNode__optionCheckboxChecked"),children:u("input",{ref:i,className:"PollNode__optionCheckbox",type:"checkbox",onChange:o=>{s((o=>{o.toggleVote(e,a)}))},checked:r})}),_("div",{className:"PollNode__optionInputWrapper",children:[u("div",{className:"PollNode__optionInputVotes",style:{width:(0===c?0:c/l*100)+"%"}}),u("span",{className:"PollNode__optionInputVotesCount",children:c>0&&(1===c?"1 vote":`${c} votes`)}),u("input",{className:"PollNode__optionInput",type:"text",value:p,onChange:o=>{const t=o.target,n=t.value,l=t.selectionStart,a=t.selectionEnd;s((o=>{o.setOptionText(e,n)}),(()=>{t.selectionStart=l,t.selectionEnd=a}))},placeholder:`Option ${t+1}`})]}),u("button",{disabled:n.length<3,className:m("PollNode__optionDelete",n.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remove",onClick:()=>{s((o=>{o.deleteOption(e)}))}})]})}function g({question:N,options:m,nodeKey:g}){const[v]=e(),P=o.exports.useMemo((()=>function(e){return e.reduce(((e,o)=>e+o.votes.length),0)}(m)),[m]),[C,k,b]=t(g),[O,y]=o.exports.useState(null),D=o.exports.useRef(null),I=o.exports.useCallback((e=>{if(C&&n(l())){e.preventDefault();const o=s(g);a(o)&&o.remove()}return!1}),[C,g]);o.exports.useEffect((()=>i(v.registerUpdateListener((({editorState:e})=>{y(e.read((()=>l())))})),v.registerCommand(d,(e=>{const o=e;return o.target===D.current&&(o.shiftKey||b(),k(!C),!0)}),r),v.registerCommand(c,I,r),v.registerCommand(p,I,r))),[b,v,C,g,I,k]);const V=(e,o)=>{v.update((()=>{const o=s(g);a(o)&&e(o)}),{onUpdate:o})},S=n(O)&&C;return u("div",{className:"PollNode__container "+(S?"focused":""),ref:D,children:_("div",{className:"PollNode__inner",children:[u("h2",{className:"PollNode__heading",children:N}),m.map(((e,o)=>{const t=e.uid;return u(x,{withPollNode:V,option:e,index:o,options:m,totalVotes:P},t)})),u("div",{className:"PollNode__footer",children:u(h,{onClick:()=>{V((e=>{e.addOption(f())}))},small:!0,children:"Add Option"})})]})})}export{g as default};
