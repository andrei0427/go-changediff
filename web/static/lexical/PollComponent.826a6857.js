import{u as I,r as x,g as O,d as C,c as k,$ as v,_ as D,m as w,i as S,k as b,l as E,n as M,a as o,j as m,B as $,o as A,a0 as y,a1 as R}from"./main.7b829983.js";function V(l){return l.reduce((s,t)=>s+t.votes.length,0)}function L({option:l,index:s,options:t,totalVotes:a,withPollNode:u}){const{clientID:d}=A(),h=x.exports.useRef(null),_=l.votes,g=_.indexOf(d)!==-1,c=_.length,f=l.text;return m("div",{className:"PollNode__optionContainer",children:[o("div",{className:y("PollNode__optionCheckboxWrapper",g&&"PollNode__optionCheckboxChecked"),children:o("input",{ref:h,className:"PollNode__optionCheckbox",type:"checkbox",onChange:p=>{u(n=>{n.toggleVote(l,d)})},checked:g})}),m("div",{className:"PollNode__optionInputWrapper",children:[o("div",{className:"PollNode__optionInputVotes",style:{width:`${c===0?0:c/a*100}%`}}),o("span",{className:"PollNode__optionInputVotesCount",children:c>0&&(c===1?"1 vote":`${c} votes`)}),o("input",{className:"PollNode__optionInput",type:"text",value:f,onChange:p=>{const n=p.target,N=n.value,e=n.selectionStart,r=n.selectionEnd;u(i=>{i.setOptionText(l,N)},()=>{n.selectionStart=e,n.selectionEnd=r})},placeholder:`Option ${s+1}`})]}),o("button",{disabled:t.length<3,className:y("PollNode__optionDelete",t.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remove",onClick:()=>{u(p=>{p.deleteOption(l)})}})]})}function z({question:l,options:s,nodeKey:t}){const[a]=I(),u=x.exports.useMemo(()=>V(s),[s]),[d,h,_]=O(t),[P,g]=x.exports.useState(null),c=x.exports.useRef(null),f=x.exports.useCallback(e=>{if(d&&C(k())){e.preventDefault();const i=v(t);D(i)&&i.remove()}return!1},[d,t]);x.exports.useEffect(()=>w(a.registerUpdateListener(({editorState:e})=>{g(e.read(()=>k()))}),a.registerCommand(M,e=>{const r=e;return r.target===c.current?(r.shiftKey||_(),h(!d),!0):!1},b),a.registerCommand(E,f,b),a.registerCommand(S,f,b)),[_,a,d,t,f,h]);const p=(e,r)=>{a.update(()=>{const i=v(t);D(i)&&e(i)},{onUpdate:r})},n=()=>{p(e=>{e.addOption(R())})},N=C(P)&&d;return o("div",{className:`PollNode__container ${N?"focused":""}`,ref:c,children:m("div",{className:"PollNode__inner",children:[o("h2",{className:"PollNode__heading",children:l}),s.map((e,r)=>{const i=e.uid;return o(L,{withPollNode:p,option:e,index:r,options:s,totalVotes:u},i)}),o("div",{className:"PollNode__footer",children:o($,{onClick:n,small:!0,children:"Add Option"})})]})})}export{z as default};
