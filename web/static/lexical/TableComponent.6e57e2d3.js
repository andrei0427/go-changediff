import{g as e,r as t,a8 as n,u as l,a9 as r,aa as s,$ as o,ab as a,ac as i,ad as c,ae as u,m as d,i as p,c as m,d as f,k as h,af as g,ag as x,ah as C,n as y,l as v,ai as b,t as N,aj as E,ak as w,s as S,al as k,am as T,an as R,K as D,j as K,a as O,F as A,f as L,ao as M,ap as P,aq as I,ar as X,as as $,at as z,au as B,av as j,aw as J,ax as Y,ay as _,az as H}from"./main.9d8dd8ca.js";import{L as q}from"./LexicalNestedComposer.aaf5e289.js";const U=[];function F(e){return`<p class="${e.paragraph}"><br></p>`}function W(e,t){const n=e.querySelector(`[data-id=${t}]`);null!=n&&n.focus()}function G(e,t){const n=t.parseEditorState(e);let l=P.get(e);if(void 0===l){l=n.read((()=>I(t,null)));const s=n.read((()=>c().getTextContent()));P.set(e,l),r.set(e,s)}return l}function Q(e){const t=e.getRootElement();return null!==t?t.ownerDocument:document}function V(e){let t=e;for(;null!==t;){const e=t.getAttribute("data-id");if(null!=e)return e;t=t.parentElement}return null}function Z(e){let t=e;for(;null!==t;){if("TH"===t.nodeName||"TD"===t.nodeName)return t.getBoundingClientRect().width;t=t.parentElement}return 0}function ee(e,t,n,l,r,s){for(const o of t){const t=re(e,o,n);if(null!==t&&null!==l){const e=l.parseEditorState(t.json);l._headless=!0,l.setEditorState(e),l.update(s,{discrete:!0}),l._headless=!1;const a=JSON.stringify(l.getEditorState());r((e=>{const[t,l]=n.get(o);i("history-push"),e.updateCellJSON(t,l,a)}))}}}function te(e,t,n){const l=n.get(e),r=n.get(t);if(void 0===l||void 0===r)return null;const s=Math.min(l[0],r[0]),o=Math.max(l[0],r[0]),a=Math.min(l[1],r[1]);return{endX:o,endY:Math.max(l[1],r[1]),startX:s,startY:a}}function ne(e,t,n,l){const r=te(t,n,l);if(null===r)return[];const{startX:s,endY:o,endX:a,startY:i}=r,c=[];for(let u=s;u<=a;u++)for(let t=i;t<=o;t++)c.push(e[t].cells[u].id);return c}function le({cellEditor:e}){const{cellEditorConfig:l,cellEditorPlugins:r}=t.exports.useContext(n);return null===r||null===l?null:O(q,{initialEditor:e,initialTheme:l.theme,initialNodes:l.nodes,skipCollabChecks:!0,children:r})}function re(e,t,n){const l=n.get(t);if(void 0===l)return null;const[r,s]=l;return e[s].cells[r]}function se({cell:e,rows:n,cellCoordMap:l,menuElem:r,updateCellsByID:s,onClose:o,updateTableNode:a,setSortingOptions:d,sortingOptions:p}){const m=t.exports.useRef(null);t.exports.useEffect((()=>{const e=m.current;if(null!==e){const t=r.getBoundingClientRect();e.style.top=`${t.y}px`,e.style.left=`${t.x}px`}}),[r]),t.exports.useEffect((()=>{const e=e=>{const t=m.current;null===t||t.contains(e.target)||e.stopPropagation()};return window.addEventListener("click",e),()=>window.removeEventListener("click",e)}),[o]);const f=l.get(e.id);if(void 0===f)return null;const[h,g]=f;return K("div",{className:"dropdown",ref:m,onPointerMove:e=>{e.stopPropagation()},onPointerDown:e=>{e.stopPropagation()},onPointerUp:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation()},children:[O("button",{className:"item",onClick:()=>{a((t=>{i("history-push"),t.updateCellType(h,g,"normal"===e.type?"header":"normal")})),o()},children:O("span",{className:"text",children:"normal"===e.type?"Make header":"Remove header"})}),O("button",{className:"item",onClick:()=>{s([e.id],(()=>{const e=c();e.clear(),e.append(u())})),o()},children:O("span",{className:"text",children:"Clear cell"})}),O("hr",{}),"header"===e.type&&0===g&&K(A,{children:[null!==p&&p.x===h&&O("button",{className:"item",onClick:()=>{d(null),o()},children:O("span",{className:"text",children:"Remove sorting"})}),(null===p||p.x!==h||"descending"===p.type)&&O("button",{className:"item",onClick:()=>{d({type:"ascending",x:h}),o()},children:O("span",{className:"text",children:"Sort ascending"})}),(null===p||p.x!==h||"ascending"===p.type)&&O("button",{className:"item",onClick:()=>{d({type:"descending",x:h}),o()},children:O("span",{className:"text",children:"Sort descending"})}),O("hr",{})]}),O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.insertRowAt(g)})),o()},children:O("span",{className:"text",children:"Insert row above"})}),O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.insertRowAt(g+1)})),o()},children:O("span",{className:"text",children:"Insert row below"})}),O("hr",{}),O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.insertColumnAt(h)})),o()},children:O("span",{className:"text",children:"Insert column left"})}),O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.insertColumnAt(h+1)})),o()},children:O("span",{className:"text",children:"Insert column right"})}),O("hr",{}),1!==n[0].cells.length&&O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.deleteColumnAt(h)})),o()},children:O("span",{className:"text",children:"Delete column"})}),1!==n.length&&O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.deleteRowAt(g)})),o()},children:O("span",{className:"text",children:"Delete row"})}),O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.selectNext(),e.remove()})),o()},children:O("span",{className:"text",children:"Delete table"})})]})}function oe({cell:e,cellCoordMap:n,cellEditor:l,isEditing:r,isSelected:s,isPrimarySelected:o,theme:a,updateCellsByID:i,updateTableNode:c,rows:u,setSortingOptions:d,sortingOptions:p}){const[m,f]=t.exports.useState(!1),h=t.exports.useRef(null),g="normal"!==e.type,x=e.json,C=g?"th":"td",y=e.width,v=h.current,b=n.get(e.id),N=null!==p&&void 0!==b&&b[0]===p.x&&0===b[1];return t.exports.useEffect((()=>{!r&&o||f(!1)}),[r,o]),K(C,{className:`${a.tableCell} ${g?a.tableCellHeader:""} ${s?a.tableCellSelected:""}`,"data-id":e.id,tabIndex:-1,style:{width:null!==y?y:void 0},children:[o&&O("div",{className:`${a.tableCellPrimarySelected} ${r?a.tableCellEditing:""}`}),o&&r?O(le,{cellEditor:l}):K(A,{children:[O("div",{dangerouslySetInnerHTML:{__html:""===x?F(a):G(x,l)}}),O("div",{className:a.tableCellResizer,"data-table-resize":"true"})]}),o&&!r&&O("div",{className:a.tableCellActionButtonContainer,ref:h,children:O("button",{className:a.tableCellActionButton,onClick:e=>{f(!m),e.stopPropagation()},children:O("i",{className:"chevron-down"})})}),m&&null!==v&&L.exports.createPortal(O(se,{cell:e,menuElem:v,updateCellsByID:i,onClose:()=>f(!1),updateTableNode:c,cellCoordMap:n,rows:u,setSortingOptions:d,sortingOptions:p}),document.body),N&&O("div",{className:a.tableCellSortedIndicator})]})}function ae({nodeKey:A,rows:L,theme:I}){var q;const[F,G,le]=e(A),se=t.exports.useRef({point:0,size:0}),[ae,ie]=t.exports.useState(null),ce=t.exports.useRef(null),ue=t.exports.useRef(null),de=t.exports.useRef(null),{cellEditorConfig:pe}=t.exports.useContext(n),[me,fe]=t.exports.useState(!1),[he,ge]=t.exports.useState(!1),[xe,Ce]=t.exports.useState(!1),[ye]=l(),ve=t.exports.useRef(!1),[be,Ne]=t.exports.useState(null),Ee=t.exports.useRef(null),we=t.exports.useMemo((()=>{const e=new Map;for(let t=0;t<L.length;t++){const n=L[t].cells;for(let l=0;l<n.length;l++){const r=n[l];e.set(r.id,[l,t])}}return e}),[L]),Se=t.exports.useMemo((()=>{if(null===ae)return L;const e=L.slice(1);return e.sort(((e,t)=>{const n=e.cells,l=t.cells,s=ae.x,o=r.get(n[s].json)||"",a=r.get(l[s].json)||"";return""===o||""===a?1:"ascending"===ae.type?o.localeCompare(a):a.localeCompare(o)})),e.unshift(L[0]),e}),[L,ae]),[ke,Te]=t.exports.useState(null),Re=t.exports.useMemo((()=>{if(null===pe)return null;const e=s({namespace:pe.namespace,nodes:pe.nodes,onError:t=>pe.onError(t,e),theme:pe.theme});return e}),[pe]),[De,Ke]=t.exports.useState([]),Oe=t.exports.useMemo((()=>new Set(De)),[De]);t.exports.useEffect((()=>{const e=Ee.current;F&&document.activeElement===document.body&&null!==e&&e.focus()}),[F]);const Ae=t.exports.useCallback((e=>{ye.update((()=>{const t=o(A);a(t)&&e(t)}))}),[ye,A]),Le=t.exports.useCallback(((e,t,n)=>{const l=Se[t].cells[e].id;if(ue.current=l,n){const e=ne(Se,ke,l,we);Ke(e)}else Te(l),Ke(U),W(Ee.current,l)}),[we,ke,Se]),Me=t.exports.useCallback((()=>{if(null!==Re&&null!==ke){const e=JSON.stringify(Re.getEditorState());Ae((t=>{const n=we.get(ke);if(void 0===n)return;i("history-push");const[l,r]=n;t.updateCellJSON(l,r,e)}))}}),[we,Re,ke,Ae]),Pe=t.exports.useCallback((()=>{setTimeout((()=>{var e;const t=ye.getRootElement();null!==t&&(t.focus({preventScroll:!0}),null==(e=window.getSelection())||e.removeAllRanges())}),20)}),[ye]);t.exports.useEffect((()=>{const e=Ee.current;if(null===e)return;const t=Q(ye),n=t=>{const n=V(t.target);if(null!==n&&ye.isEditable()&&e.contains(t.target)){if((e=>{const t=e.clientX-l.x,n=e.clientY-l.y;return t<5||n<5})(t))return G(!0),Te(null),void Pe();if(G(!1),1===(r=t.target).nodeType&&r.hasAttribute("data-table-resize"))return Ne(n),e.style.userSelect="none",void(se.current={point:t.clientX,size:Z(t.target)});ve.current=!0,ke!==n?(me&&Me(),Te(n),fe(!1),ue.current=n):ue.current=null,Ke(U)}else null===ke||function(e){let t=e;for(;null!==t;){const e=t.nodeName;if("BUTTON"===e||"INPUT"===e||"TEXTAREA"===e)return!0;t=t.parentElement}return!1}(t.target)||(G(!1),ve.current=!1,me&&Me(),Te(null),Ke(U),fe(!1),ue.current=null);var r},l=e.getBoundingClientRect(),r=t=>{if(null!==be){const e=de.current;if(null!==e){const{size:n,point:r}=se.current,s=n+(t.clientX-r);let o=t.clientX-l.x;o<10?o=10:o>l.width-10?o=l.width-10:s<20&&(o=r-n+20-l.x),e.style.left=`${o}px`}return}if(!me){const{clientX:e,clientY:n}=t,{width:r,x:s,y:o,height:a}=l,i=e>s+.9*r&&e<s+r+40&&!ve.current;ge(i);const c=t.target===ce.current||n>o+.85*a&&n<o+a+5&&!ve.current;Ce(c)}if(me||!ve.current||null===ke)return;const n=V(t.target);if(null!==n&&n!==ue.current){0===De.length&&(e.style.userSelect="none");const t=ne(Se,ke,n,we);1===t.length?Ke(U):Ke(t),ue.current=n}},s=t=>{var n;if(null!==be){const{size:e,point:n}=se.current;let l=e+(t.clientX-n);l<10&&(l=10),Ae((e=>{const[t]=we.get(be);i("history-push"),e.updateColumnWidth(t,l)})),Ne(null)}null!==e&&De.length>1&&ve.current&&(e.style.userSelect="text",null==(n=window.getSelection())||n.removeAllRanges()),ve.current=!1};return t.addEventListener("pointerdown",n),t.addEventListener("pointermove",r),t.addEventListener("pointerup",s),()=>{t.removeEventListener("pointerdown",n),t.removeEventListener("pointermove",r),t.removeEventListener("pointerup",s)}}),[Re,ye,me,Se,Me,ke,Oe,De,we,be,Ae,G,Pe]),t.exports.useEffect((()=>{if(!me&&null!==ke){const e=Q(ye),t=e=>{if(null!==e&&null!==Re){const t=e.json,n=Re.parseEditorState(t);Re.setEditorState(n)}},n=e=>{const n=V(e.target);if(n===ke&&ye.isEditable()){const e=re(Se,n,we);t(e),fe(!0),Ke(U)}},l=e=>{const n=e.keyCode;if(16===n||27===n||9===n||37===n||38===n||39===n||40===n||8===n||46===n||!ye.isEditable())return;if(13===n&&e.preventDefault(),!me&&null!==ke&&ye.getEditorState().read((()=>null===m()))&&"true"!==e.target.contentEditable){if(function(e,t,n,l){return!t&&67===e&&(X?n:l)}(n,e.shiftKey,e.metaKey,e.ctrlKey))return void ye.dispatchCommand(x,e);if(function(e,t,n,l){return!t&&88===e&&(X?n:l)}(n,e.shiftKey,e.metaKey,e.ctrlKey))return void ye.dispatchCommand(C,e);if(function(e,t,n,l){return!t&&86===e&&(X?n:l)}(n,e.shiftKey,e.metaKey,e.ctrlKey))return void ye.dispatchCommand(g,e)}if(e.metaKey||e.ctrlKey||e.altKey)return;const l=re(Se,ke,we);t(l),fe(!0),Ke(U)};return e.addEventListener("dblclick",n),e.addEventListener("keydown",l),()=>{e.removeEventListener("dblclick",n),e.removeEventListener("keydown",l)}}}),[Re,ye,me,Se,ke,we]);const Ie=t.exports.useCallback(((e,t)=>{ee(Se,e,we,Re,Ae,t)}),[we,Re,Se,Ae]),Xe=t.exports.useCallback((()=>null===ke||me?(F&&Ae((e=>{i("history-push"),e.selectNext(),e.remove()})),!1):(Ie([ke,...De],(()=>{const e=c();e.clear(),e.append(u())})),!0)),[me,F,ke,De,Ie,Ae]);if(t.exports.useEffect((()=>{const e=Ee.current;if(null===e)return;const t=(e,t,n,l)=>{const r=e instanceof KeyboardEvent?null:e.clipboardData;if(e.preventDefault(),null!=r)r.setData("text/html",t),r.setData("text/plain",l),r.setData("application/x-lexical-editor",n);else{const e=navigator.clipboard;if(null!=e){const n=[new ClipboardItem({"text/html":new Blob([t],{type:"text/html"})})];e.write(n)}}},n=async(e,t)=>{try{return e instanceof DataTransfer?e.getData(t):e instanceof ClipboardItem?await(await e.getType(t)).text():""}catch{return""}},l=e=>{const n=ue.current;if(null!==ke&&null!==Re&&null!==n){const l=te(ke,n,we);if(null===l)return;const r=Y(Se,l),s=r.outerHTML,a=r.outerText,i=ye.getEditorState().read((()=>o(A).exportJSON()));i.rows=function(e,t){const{startX:n,endY:l,endX:r,startY:s}=t,o=[];for(let a=s;a<=l;a++){const t=e[a],l=_();for(let e=n;e<=r;e++){const n={...t.cells[e]};n.id=H(),l.cells.push(n)}o.push(l)}return o}(Se,l);const c={namespace:Re._config.namespace,nodes:[i]},u=JSON.stringify(c);t(e,s,u,a)}},r=(e,n)=>{const r=m();return null!==ke&&!me&&null===r&&n===ye&&(0===De.length?(e=>{if(null!==ke&&null!==Re){const n=re(Se,ke,we).json,l=P.get(n)||null;if(null===l)return;const r=Re.parseEditorState(n),s=r.read((()=>c().getTextContent())),o=r.read((()=>JSON.stringify(J(Re,null))));t(e,l,o,s)}})(e):l(e),!0)};return d(ye.registerCommand(p,(e=>{const t=m();return!!f(t)}),h),ye.registerCommand(g,((e,t)=>{const l=m();return null!==ke&&!me&&null===l&&t===ye&&((async e=>{let t=(e instanceof InputEvent?null:e.clipboardData)||null;if(null!==ke&&null!==Re){if(e.preventDefault(),null===t)try{t=(await navigator.clipboard.read())[0]}catch{}const l=null!==t?await n(t,"application/x-lexical-editor"):"";if(l)try{const e=JSON.parse(l);if(e.namespace===ye._config.namespace&&Array.isArray(e.nodes))return void ee(Se,[ke],we,Re,Ae,(()=>{const t=c();t.clear(),t.append(u()),t.selectEnd();const n=$(e.nodes),l=m();S(l)&&z(Re,n,l)}))}catch{}const r=null!==t?await n(t,"text/html"):"";if(r)try{const e=(new DOMParser).parseFromString(r,"text/html"),t=e.querySelector("table");if(null!=t){const e=B(t);return void Ae((t=>{const[n,l]=we.get(ke);i("history-push"),t.mergeRows(n,l,e)}))}return void ee(Se,[ke],we,Re,Ae,(()=>{const t=c();t.clear(),t.append(u()),t.selectEnd();const n=j(ye,e),l=m();S(l)&&z(Re,n,l)}))}catch{}const s=null!==t?await n(t,"text/plain"):"";null!=s&&ee(Se,[ke],we,Re,Ae,(()=>{const e=c();e.clear(),e.selectEnd();const t=m();null!==t&&t.insertRawText(s)}))}})(e),ve.current=!1,Ke(U),!0)}),h),ye.registerCommand(x,r,h),ye.registerCommand(C,((e,t)=>!!r(e,t)&&(Xe(),!0)),h),ye.registerCommand(y,Xe,h),ye.registerCommand(v,Xe,h),ye.registerCommand(b,(e=>null!==ke&&!me&&(ee(Se,[ke,...De],we,Re,Ae,(()=>{(function(){const e=M();return e.focus.set("root",c().getChildrenSize(),"element"),e})().formatText(e)})),!0)),h),ye.registerCommand(N,((t,n)=>{const l=m();if(null===ke&&!me&&f(l)&&l.has(A)&&1===l.getNodes().length&&n===ye){const n=Se[0].cells[0].id;return Te(n),W(e,n),t.preventDefault(),t.stopPropagation(),le(),!0}return!1}),h),ye.registerCommand(E,(e=>{const t=m();if(!me&&null===t&&null!==ke){const t=e.shiftKey,[n,l]=we.get(ke);e.preventDefault();let r=null,s=null;if(0===n&&t?0!==l&&(s=l-1,r=Se[s].cells.length-1):n!==Se[l].cells.length-1||t?t?(r=n-1,s=l):(r=n+1,s=l):l!==Se.length-1&&(s=l+1,r=0),null!==r&&null!==s)return Le(r,s,!1),!0}return!1}),h),ye.registerCommand(w,((e,t)=>{const n=m();if(!me&&null===n){const t=e.shiftKey,n=t&&ue.current||ke;if(null!==n){const[e,l]=we.get(n);if(0!==l)return Le(e,l-1,t),!0}}return!(!S(n)||t!==Re)&&(!(!n.isCollapsed()||null!==n.anchor.getNode().getTopLevelElementOrThrow().getPreviousSibling())&&(e.preventDefault(),!0))}),h),ye.registerCommand(k,((e,t)=>{const n=m();if(!me&&null===n){const t=e.shiftKey,n=t&&ue.current||ke;if(null!==n){const[e,l]=we.get(n);if(l!==Se.length-1)return Le(e,l+1,t),!0}}return!(!S(n)||t!==Re)&&(!(!n.isCollapsed()||null!==n.anchor.getNode().getTopLevelElementOrThrow().getNextSibling())&&(e.preventDefault(),!0))}),h),ye.registerCommand(T,((e,t)=>{const n=m();if(!me&&null===n){const t=e.shiftKey,n=t&&ue.current||ke;if(null!==n){const[e,l]=we.get(n);if(0!==e)return Le(e-1,l,t),!0}}return!(!S(n)||t!==Re)&&(!(!n.isCollapsed()||0!==n.anchor.offset)&&(e.preventDefault(),!0))}),h),ye.registerCommand(R,((e,t)=>{const n=m();if(!me&&null===n){const t=e.shiftKey,n=t&&ue.current||ke;if(null!==n){const[e,l]=we.get(n);if(e!==Se[l].cells.length-1)return Le(e+1,l,t),!0}}if(!S(n)||t!==Re)return!1;if(n.isCollapsed()){const t=n.anchor;if("text"===t.type&&t.offset===t.getNode().getTextContentSize()||"element"===t.type&&t.offset===t.getNode().getChildrenSize())return e.preventDefault(),!0}return!1}),h),ye.registerCommand(D,((t,n)=>{const l=m();return me||null!==l||n!==ye?!!S(l)&&(!!me&&(Me(),fe(!1),null!==ke&&setTimeout((()=>{W(e,ke)}),20),!0)):(G(!0),Te(null),Pe(),!0)}),h))}),[we,Re,Xe,le,ye,me,Le,A,ke,Se,Me,Pe,De,G,Ae]),null!==Re)return K("div",{style:{position:"relative",width:((null==(q=Ee.current)?void 0:q.offsetWidth)||0)+"px"},children:[O("table",{className:`${I.table} ${F?I.tableSelected:""}`,ref:Ee,tabIndex:-1,children:O("tbody",{children:Se.map((e=>O("tr",{className:I.tableRow,children:e.cells.map((e=>{const{id:t}=e;return O(oe,{cell:e,theme:I,isSelected:Oe.has(t),isPrimarySelected:ke===t,isEditing:me,sortingOptions:ae,cellEditor:Re,updateCellsByID:Ie,updateTableNode:Ae,cellCoordMap:we,rows:Se,setSortingOptions:ie},t)}))},e.id)))})}),he&&O("button",{className:I.tableAddColumns,onClick:()=>{Ae((e=>{i("history-push"),e.addColumns(1)}))}}),xe&&O("button",{className:I.tableAddRows,onClick:()=>{Ae((e=>{i("history-push"),e.addRows(1)}))},ref:ce}),null!==be&&O("div",{className:I.tableResizeRuler,ref:de})]})}export{ae as default};
