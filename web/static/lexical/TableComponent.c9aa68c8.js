import{g as e,r as t,a6 as n,u as l,a7 as r,a8 as s,$ as o,a9 as a,aa as i,ab as c,ac as u,m as d,i as p,c as m,d as f,k as h,ad as g,ae as x,af as C,n as y,l as v,ag as b,s as N,ah as E,ai as S,aj as w,ak as k,al as T,am as R,K as D,j as K,a as O,F as A,f as L,an as M,ao as P,ap as I,aq as X,ar as $,as as z,at as B,au as j,av as J,aw as Y,ax as _,ay as H}from"./main.00ecd330.js";import{L as q}from"./LexicalNestedComposer.90c8ce6e.js";const U=[];function F(e){return`<p class="${e.paragraph}"><br></p>`}function W(e,t){const n=e.querySelector(`[data-id=${t}]`);null!=n&&n.focus()}function G(e,t){const n=t.parseEditorState(e);let l=P.get(e);if(void 0===l){l=n.read((()=>I(t,null)));const s=n.read((()=>c().getTextContent()));P.set(e,l),r.set(e,s)}return l}function Q(e){const t=e.getRootElement();return null!==t?t.ownerDocument:document}function V(e){let t=e;for(;null!==t;){const e=t.getAttribute("data-id");if(null!=e)return e;t=t.parentElement}return null}function Z(e){let t=e;for(;null!==t;){if("TH"===t.nodeName||"TD"===t.nodeName)return t.getBoundingClientRect().width;t=t.parentElement}return 0}function ee(e,t,n,l,r,s){for(const o of t){const t=re(e,o,n);if(null!==t&&null!==l){const e=l.parseEditorState(t.json);l._headless=!0,l.setEditorState(e),l.update(s,{discrete:!0}),l._headless=!1;const a=JSON.stringify(l.getEditorState());r((e=>{const[t,l]=n.get(o);i("history-push"),e.updateCellJSON(t,l,a)}))}}}function te(e,t,n){const l=n.get(e),r=n.get(t);if(void 0===l||void 0===r)return null;const s=Math.min(l[0],r[0]),o=Math.max(l[0],r[0]),a=Math.min(l[1],r[1]);return{endX:o,endY:Math.max(l[1],r[1]),startX:s,startY:a}}function ne(e,t,n,l){const r=te(t,n,l);if(null===r)return[];const{startX:s,endY:o,endX:a,startY:i}=r,c=[];for(let u=s;u<=a;u++)for(let t=i;t<=o;t++)c.push(e[t].cells[u].id);return c}function le({cellEditor:e}){const{cellEditorConfig:l,cellEditorPlugins:r}=t.exports.useContext(n);return null===r||null===l?null:O(q,{initialEditor:e,initialTheme:l.theme,initialNodes:l.nodes,skipCollabChecks:!0,children:r})}function re(e,t,n){const l=n.get(t);if(void 0===l)return null;const[r,s]=l;return e[s].cells[r]}function se({cell:e,rows:n,cellCoordMap:l,menuElem:r,updateCellsByID:s,onClose:o,updateTableNode:a,setSortingOptions:d,sortingOptions:p}){const m=t.exports.useRef(null);t.exports.useEffect((()=>{const e=m.current;if(null!==e){const t=r.getBoundingClientRect();e.style.top=`${t.y}px`,e.style.left=`${t.x}px`}}),[r]),t.exports.useEffect((()=>{const e=e=>{const t=m.current;null===t||t.contains(e.target)||e.stopPropagation()};return window.addEventListener("click",e),()=>window.removeEventListener("click",e)}),[o]);const f=l.get(e.id);if(void 0===f)return null;const[h,g]=f;return K("div",{className:"dropdown",ref:m,onPointerMove:e=>{e.stopPropagation()},onPointerDown:e=>{e.stopPropagation()},onPointerUp:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation()},children:[O("button",{className:"item",onClick:()=>{a((t=>{i("history-push"),t.updateCellType(h,g,"normal"===e.type?"header":"normal")})),o()},children:O("span",{className:"text",children:"normal"===e.type?"Make header":"Remove header"})}),O("button",{className:"item",onClick:()=>{s([e.id],(()=>{const e=c();e.clear(),e.append(u())})),o()},children:O("span",{className:"text",children:"Clear cell"})}),O("hr",{}),"header"===e.type&&0===g&&K(A,{children:[null!==p&&p.x===h&&O("button",{className:"item",onClick:()=>{d(null),o()},children:O("span",{className:"text",children:"Remove sorting"})}),(null===p||p.x!==h||"descending"===p.type)&&O("button",{className:"item",onClick:()=>{d({type:"ascending",x:h}),o()},children:O("span",{className:"text",children:"Sort ascending"})}),(null===p||p.x!==h||"ascending"===p.type)&&O("button",{className:"item",onClick:()=>{d({type:"descending",x:h}),o()},children:O("span",{className:"text",children:"Sort descending"})}),O("hr",{})]}),O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.insertRowAt(g)})),o()},children:O("span",{className:"text",children:"Insert row above"})}),O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.insertRowAt(g+1)})),o()},children:O("span",{className:"text",children:"Insert row below"})}),O("hr",{}),O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.insertColumnAt(h)})),o()},children:O("span",{className:"text",children:"Insert column left"})}),O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.insertColumnAt(h+1)})),o()},children:O("span",{className:"text",children:"Insert column right"})}),O("hr",{}),1!==n[0].cells.length&&O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.deleteColumnAt(h)})),o()},children:O("span",{className:"text",children:"Delete column"})}),1!==n.length&&O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.deleteRowAt(g)})),o()},children:O("span",{className:"text",children:"Delete row"})}),O("button",{className:"item",onClick:()=>{a((e=>{i("history-push"),e.selectNext(),e.remove()})),o()},children:O("span",{className:"text",children:"Delete table"})})]})}function oe({cell:e,cellCoordMap:n,cellEditor:l,isEditing:r,isSelected:s,isPrimarySelected:o,theme:a,updateCellsByID:i,updateTableNode:c,rows:u,setSortingOptions:d,sortingOptions:p}){const[m,f]=t.exports.useState(!1),h=t.exports.useRef(null),g="normal"!==e.type,x=e.json,C=g?"th":"td",y=e.width,v=h.current,b=n.get(e.id),N=null!==p&&void 0!==b&&b[0]===p.x&&0===b[1];return t.exports.useEffect((()=>{!r&&o||f(!1)}),[r,o]),K(C,{className:`${a.tableCell} ${g?a.tableCellHeader:""} ${s?a.tableCellSelected:""}`,"data-id":e.id,tabIndex:-1,style:{width:null!==y?y:void 0},children:[o&&O("div",{className:`${a.tableCellPrimarySelected} ${r?a.tableCellEditing:""}`}),o&&r?O(le,{cellEditor:l}):K(A,{children:[O("div",{dangerouslySetInnerHTML:{__html:""===x?F(a):G(x,l)}}),O("div",{className:a.tableCellResizer,"data-table-resize":"true"})]}),o&&!r&&O("div",{className:a.tableCellActionButtonContainer,ref:h,children:O("button",{className:a.tableCellActionButton,onClick:e=>{f(!m),e.stopPropagation()},children:O("i",{className:"chevron-down"})})}),m&&null!==v&&L.exports.createPortal(O(se,{cell:e,menuElem:v,updateCellsByID:i,onClose:()=>f(!1),updateTableNode:c,cellCoordMap:n,rows:u,setSortingOptions:d,sortingOptions:p}),document.body),N&&O("div",{className:a.tableCellSortedIndicator})]})}function ae({nodeKey:A,rows:L,theme:I}){const[q,F,G]=e(A),le=t.exports.useRef({point:0,size:0}),[se,ae]=t.exports.useState(null),ie=t.exports.useRef(null),ce=t.exports.useRef(null),ue=t.exports.useRef(null),{cellEditorConfig:de}=t.exports.useContext(n),[pe,me]=t.exports.useState(!1),[fe,he]=t.exports.useState(!1),[ge,xe]=t.exports.useState(!1),[Ce]=l(),ye=t.exports.useRef(!1),[ve,be]=t.exports.useState(null),Ne=t.exports.useRef(null),Ee=t.exports.useMemo((()=>{const e=new Map;for(let t=0;t<L.length;t++){const n=L[t].cells;for(let l=0;l<n.length;l++){const r=n[l];e.set(r.id,[l,t])}}return e}),[L]),Se=t.exports.useMemo((()=>{if(null===se)return L;const e=L.slice(1);return e.sort(((e,t)=>{const n=e.cells,l=t.cells,s=se.x,o=r.get(n[s].json)||"",a=r.get(l[s].json)||"";return""===o||""===a?1:"ascending"===se.type?o.localeCompare(a):a.localeCompare(o)})),e.unshift(L[0]),e}),[L,se]),[we,ke]=t.exports.useState(null),Te=t.exports.useMemo((()=>{if(null===de)return null;const e=s({namespace:de.namespace,nodes:de.nodes,onError:t=>de.onError(t,e),theme:de.theme});return e}),[de]),[Re,De]=t.exports.useState([]),Ke=t.exports.useMemo((()=>new Set(Re)),[Re]);t.exports.useEffect((()=>{const e=Ne.current;q&&document.activeElement===document.body&&null!==e&&e.focus()}),[q]);const Oe=t.exports.useCallback((e=>{Ce.update((()=>{const t=o(A);a(t)&&e(t)}))}),[Ce,A]),Ae=t.exports.useCallback(((e,t,n)=>{const l=Se[t].cells[e].id;if(ce.current=l,n){const e=ne(Se,we,l,Ee);De(e)}else ke(l),De(U),W(Ne.current,l)}),[Ee,we,Se]),Le=t.exports.useCallback((()=>{if(null!==Te&&null!==we){const e=JSON.stringify(Te.getEditorState());Oe((t=>{const n=Ee.get(we);if(void 0===n)return;i("history-push");const[l,r]=n;t.updateCellJSON(l,r,e)}))}}),[Ee,Te,we,Oe]),Me=t.exports.useCallback((()=>{setTimeout((()=>{var e;const t=Ce.getRootElement();null!==t&&(t.focus({preventScroll:!0}),null==(e=window.getSelection())||e.removeAllRanges())}),20)}),[Ce]);t.exports.useEffect((()=>{const e=Ne.current;if(null===e)return;const t=Q(Ce),n=t=>{const n=V(t.target);if(null!==n&&Ce.isEditable()&&e.contains(t.target)){if((e=>{const t=e.clientX-l.x,n=e.clientY-l.y;return t<5||n<5})(t))return F(!0),ke(null),void Me();if(F(!1),1===(r=t.target).nodeType&&r.hasAttribute("data-table-resize"))return be(n),e.style.userSelect="none",void(le.current={point:t.clientX,size:Z(t.target)});ye.current=!0,we!==n?(pe&&Le(),ke(n),me(!1),ce.current=n):ce.current=null,De(U)}else null===we||function(e){let t=e;for(;null!==t;){const e=t.nodeName;if("BUTTON"===e||"INPUT"===e||"TEXTAREA"===e)return!0;t=t.parentElement}return!1}(t.target)||(F(!1),ye.current=!1,pe&&Le(),ke(null),De(U),me(!1),ce.current=null);var r},l=e.getBoundingClientRect(),r=t=>{if(null!==ve){const e=ue.current;if(null!==e){const{size:n,point:r}=le.current,s=n+(t.clientX-r);let o=t.clientX-l.x;o<10?o=10:o>l.width-10?o=l.width-10:s<20&&(o=r-n+20-l.x),e.style.left=`${o}px`}return}if(!pe){const{clientX:e,clientY:n}=t,{width:r,x:s,y:o,height:a}=l,i=e>s+.9*r&&e<s+r+40&&!ye.current;he(i);const c=t.target===ie.current||n>o+.85*a&&n<o+a+5&&!ye.current;xe(c)}if(pe||!ye.current||null===we)return;const n=V(t.target);if(null!==n&&n!==ce.current){0===Re.length&&(e.style.userSelect="none");const t=ne(Se,we,n,Ee);1===t.length?De(U):De(t),ce.current=n}},s=t=>{var n;if(null!==ve){const{size:e,point:n}=le.current;let l=e+(t.clientX-n);l<10&&(l=10),Oe((e=>{const[t]=Ee.get(ve);i("history-push"),e.updateColumnWidth(t,l)})),be(null)}null!==e&&Re.length>1&&ye.current&&(e.style.userSelect="text",null==(n=window.getSelection())||n.removeAllRanges()),ye.current=!1};return t.addEventListener("pointerdown",n),t.addEventListener("pointermove",r),t.addEventListener("pointerup",s),()=>{t.removeEventListener("pointerdown",n),t.removeEventListener("pointermove",r),t.removeEventListener("pointerup",s)}}),[Te,Ce,pe,Se,Le,we,Ke,Re,Ee,ve,Oe,F,Me]),t.exports.useEffect((()=>{if(!pe&&null!==we){const e=Q(Ce),t=e=>{if(null!==e&&null!==Te){const t=e.json,n=Te.parseEditorState(t);Te.setEditorState(n)}},n=e=>{const n=V(e.target);if(n===we&&Ce.isEditable()){const e=re(Se,n,Ee);t(e),me(!0),De(U)}},l=e=>{const n=e.keyCode;if(16===n||27===n||9===n||37===n||38===n||39===n||40===n||8===n||46===n||!Ce.isEditable())return;if(13===n&&e.preventDefault(),!pe&&null!==we&&Ce.getEditorState().read((()=>null===m()))&&"true"!==e.target.contentEditable){if(function(e,t,n,l){return!t&&67===e&&(X?n:l)}(n,e.shiftKey,e.metaKey,e.ctrlKey))return void Ce.dispatchCommand(x,e);if(function(e,t,n,l){return!t&&88===e&&(X?n:l)}(n,e.shiftKey,e.metaKey,e.ctrlKey))return void Ce.dispatchCommand(C,e);if(function(e,t,n,l){return!t&&86===e&&(X?n:l)}(n,e.shiftKey,e.metaKey,e.ctrlKey))return void Ce.dispatchCommand(g,e)}if(e.metaKey||e.ctrlKey||e.altKey)return;const l=re(Se,we,Ee);t(l),me(!0),De(U)};return e.addEventListener("dblclick",n),e.addEventListener("keydown",l),()=>{e.removeEventListener("dblclick",n),e.removeEventListener("keydown",l)}}}),[Te,Ce,pe,Se,we,Ee]);const Pe=t.exports.useCallback(((e,t)=>{ee(Se,e,Ee,Te,Oe,t)}),[Ee,Te,Se,Oe]),Ie=t.exports.useCallback((()=>null===we||pe?(q&&Oe((e=>{i("history-push"),e.selectNext(),e.remove()})),!1):(Pe([we,...Re],(()=>{const e=c();e.clear(),e.append(u())})),!0)),[pe,q,we,Re,Pe,Oe]);if(t.exports.useEffect((()=>{const e=Ne.current;if(null===e)return;const t=(e,t,n,l)=>{const r=e instanceof KeyboardEvent?null:e.clipboardData;if(e.preventDefault(),null!=r)r.setData("text/html",t),r.setData("text/plain",l),r.setData("application/x-lexical-editor",n);else{const e=navigator.clipboard;if(null!=e){const n=[new ClipboardItem({"text/html":new Blob([t],{type:"text/html"})})];e.write(n)}}},n=async(e,t)=>{try{return e instanceof DataTransfer?e.getData(t):e instanceof ClipboardItem?await(await e.getType(t)).text():""}catch{return""}},l=e=>{const n=ce.current;if(null!==we&&null!==Te&&null!==n){const l=te(we,n,Ee);if(null===l)return;const r=Y(Se,l),s=r.outerHTML,a=r.outerText,i=Ce.getEditorState().read((()=>o(A).exportJSON()));i.rows=function(e,t){const{startX:n,endY:l,endX:r,startY:s}=t,o=[];for(let a=s;a<=l;a++){const t=e[a],l=_();for(let e=n;e<=r;e++){const n={...t.cells[e]};n.id=H(),l.cells.push(n)}o.push(l)}return o}(Se,l);const c={namespace:Te._config.namespace,nodes:[i]},u=JSON.stringify(c);t(e,s,u,a)}},r=(e,n)=>{const r=m();return null!==we&&!pe&&null===r&&n===Ce&&(0===Re.length?(e=>{if(null!==we&&null!==Te){const n=re(Se,we,Ee).json,l=P.get(n)||null;if(null===l)return;const r=Te.parseEditorState(n),s=r.read((()=>c().getTextContent())),o=r.read((()=>JSON.stringify(J(Te,null))));t(e,l,o,s)}})(e):l(e),!0)};return d(Ce.registerCommand(p,(e=>{const t=m();return!!f(t)}),h),Ce.registerCommand(g,((e,t)=>{const l=m();return null!==we&&!pe&&null===l&&t===Ce&&((async e=>{let t=(e instanceof InputEvent?null:e.clipboardData)||null;if(null!==we&&null!==Te){if(e.preventDefault(),null===t)try{t=(await navigator.clipboard.read())[0]}catch{}const l=null!==t?await n(t,"application/x-lexical-editor"):"";if(l)try{const e=JSON.parse(l);if(e.namespace===Ce._config.namespace&&Array.isArray(e.nodes))return void ee(Se,[we],Ee,Te,Oe,(()=>{const t=c();t.clear(),t.append(u()),t.selectEnd();const n=$(e.nodes),l=m();w(l)&&z(Te,n,l)}))}catch{}const r=null!==t?await n(t,"text/html"):"";if(r)try{const e=(new DOMParser).parseFromString(r,"text/html"),t=e.querySelector("table");if(null!=t){const e=B(t);return void Oe((t=>{const[n,l]=Ee.get(we);i("history-push"),t.mergeRows(n,l,e)}))}return void ee(Se,[we],Ee,Te,Oe,(()=>{const t=c();t.clear(),t.append(u()),t.selectEnd();const n=j(Ce,e),l=m();w(l)&&z(Te,n,l)}))}catch{}const s=null!==t?await n(t,"text/plain"):"";null!=s&&ee(Se,[we],Ee,Te,Oe,(()=>{const e=c();e.clear(),e.selectEnd();const t=m();null!==t&&t.insertRawText(s)}))}})(e),ye.current=!1,De(U),!0)}),h),Ce.registerCommand(x,r,h),Ce.registerCommand(C,((e,t)=>!!r(e,t)&&(Ie(),!0)),h),Ce.registerCommand(y,Ie,h),Ce.registerCommand(v,Ie,h),Ce.registerCommand(b,(e=>null!==we&&!pe&&(ee(Se,[we,...Re],Ee,Te,Oe,(()=>{(function(){const e=M();return e.focus.set("root",c().getChildrenSize(),"element"),e})().formatText(e)})),!0)),h),Ce.registerCommand(N,((t,n)=>{const l=m();if(null===we&&!pe&&f(l)&&l.has(A)&&1===l.getNodes().length&&n===Ce){const n=Se[0].cells[0].id;return ke(n),W(e,n),t.preventDefault(),t.stopPropagation(),G(),!0}return!1}),h),Ce.registerCommand(E,(e=>{const t=m();if(!pe&&null===t&&null!==we){const t=e.shiftKey,[n,l]=Ee.get(we);e.preventDefault();let r=null,s=null;if(0===n&&t?0!==l&&(s=l-1,r=Se[s].cells.length-1):n!==Se[l].cells.length-1||t?t?(r=n-1,s=l):(r=n+1,s=l):l!==Se.length-1&&(s=l+1,r=0),null!==r&&null!==s)return Ae(r,s,!1),!0}return!1}),h),Ce.registerCommand(S,((e,t)=>{const n=m();if(!pe&&null===n){const t=e.shiftKey,n=t&&ce.current||we;if(null!==n){const[e,l]=Ee.get(n);if(0!==l)return Ae(e,l-1,t),!0}}return!(!w(n)||t!==Te)&&(!(!n.isCollapsed()||null!==n.anchor.getNode().getTopLevelElementOrThrow().getPreviousSibling())&&(e.preventDefault(),!0))}),h),Ce.registerCommand(k,((e,t)=>{const n=m();if(!pe&&null===n){const t=e.shiftKey,n=t&&ce.current||we;if(null!==n){const[e,l]=Ee.get(n);if(l!==Se.length-1)return Ae(e,l+1,t),!0}}return!(!w(n)||t!==Te)&&(!(!n.isCollapsed()||null!==n.anchor.getNode().getTopLevelElementOrThrow().getNextSibling())&&(e.preventDefault(),!0))}),h),Ce.registerCommand(T,((e,t)=>{const n=m();if(!pe&&null===n){const t=e.shiftKey,n=t&&ce.current||we;if(null!==n){const[e,l]=Ee.get(n);if(0!==e)return Ae(e-1,l,t),!0}}return!(!w(n)||t!==Te)&&(!(!n.isCollapsed()||0!==n.anchor.offset)&&(e.preventDefault(),!0))}),h),Ce.registerCommand(R,((e,t)=>{const n=m();if(!pe&&null===n){const t=e.shiftKey,n=t&&ce.current||we;if(null!==n){const[e,l]=Ee.get(n);if(e!==Se[l].cells.length-1)return Ae(e+1,l,t),!0}}if(!w(n)||t!==Te)return!1;if(n.isCollapsed()){const t=n.anchor;if("text"===t.type&&t.offset===t.getNode().getTextContentSize()||"element"===t.type&&t.offset===t.getNode().getChildrenSize())return e.preventDefault(),!0}return!1}),h),Ce.registerCommand(D,((t,n)=>{const l=m();return pe||null!==l||n!==Ce?!!w(l)&&(!!pe&&(Le(),me(!1),null!==we&&setTimeout((()=>{W(e,we)}),20),!0)):(F(!0),ke(null),Me(),!0)}),h))}),[Ee,Te,Ie,G,Ce,pe,Ae,A,we,Se,Le,Me,Re,F,Oe]),null!==Te)return K("div",{style:{position:"relative"},children:[O("table",{className:`${I.table} ${q?I.tableSelected:""}`,ref:Ne,tabIndex:-1,children:O("tbody",{children:Se.map((e=>O("tr",{className:I.tableRow,children:e.cells.map((e=>{const{id:t}=e;return O(oe,{cell:e,theme:I,isSelected:Ke.has(t),isPrimarySelected:we===t,isEditing:pe,sortingOptions:se,cellEditor:Te,updateCellsByID:Pe,updateTableNode:Oe,cellCoordMap:Ee,rows:Se,setSortingOptions:ae},t)}))},e.id)))})}),fe&&O("button",{className:I.tableAddColumns,onClick:()=>{Oe((e=>{i("history-push"),e.addColumns(1)}))}}),ge&&O("button",{className:I.tableAddRows,onClick:()=>{Oe((e=>{i("history-push"),e.addRows(1)}))},ref:ie}),null!==ve&&O("div",{className:I.tableResizeRuler,ref:ue})]})}export{ae as default};
